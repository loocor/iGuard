## 4. 功能模块详解

### 4.1 数据采集模块

#### 功能概述：

负责学校集中筛查时的学生视力数据采集。通过与多种类型的筛查设备（如视力检测仪）连接，将采集的数据传输至局域网内的工作站或服务器，随后汇报至省级或全国后台。

- 设备兼容性：
  - 支持通过 RS-232 连接的筛查设备（如 Nidek、Topcon 等）及其对应的 WiFi 适配器。
  - 支持蓝牙接口的筛查设备。
  - 支持通过 Windows 局域网共享文件夹方式存储数据的设备。
- 采集方式：
  - 采用微信小程序与设备连接，实现身份认证和数据采集，减少繁琐操作。
  - 对于使用共享文件夹的设备，开发专门的文件监控和解析模块。
- 数据传输：
  - RS-232 和蓝牙设备：数据通过局域网无线传输至本地服务器或工作站，数据无需在适配器端解析，直接传输至服务器。
  - 共享文件夹方式：系统定期扫描指定的共享文件夹，获取新增的图片和 XML 文件，进行解析和处理。

#### 相关技术：

- RS-232 至 WiFi 转换适配器：将筛查设备的数据通过 WiFi 发送到局域网。
- 蓝牙数据接收：开发蓝牙数据接收模块，支持与蓝牙设备的配对和数据传输。
- 文件监控与解析：
  - 使用文件系统监控技术（如 Windows 的 FileSystemWatcher）来检测共享文件夹中的新文件。
  - 开发 XML 解析模块，用于处理设备生成的 XML 数据文件。
  - 图像处理模块，用于处理和分析设备生成的图片文件。
- 局域网内的分布式节点设计：节点负责数据的临时存储与透传，最终将数据上传至省级/全国级服务器。
- mDNS 服务发现：节点通过 mDNS 广播，自动发现局域网内的其他节点和服务，减少配置工作。
- 分布式节点角色：局域网中的每个节点都可以动态成为服务提供者，避免了对单一服务器的依赖，确保高可用性。
- 动态负载均衡：根据局域网中每个节点的网络状况和计算资源，动态调整任务分配，确保高负载节点的任务自动分配给其他可用节点。

#### 数据采集流程：
- 学生信息录入：校方需提前导入学生明细信息,包括姓名、性别、身份证号、班级、学校、家长联系方式等。这些信息在任务创建时关联到筛查任务。
- 实时数据采集与处理：学生持筛查信息卡进行各项检查,客户端采集检测设备的数据并进行实时校验。对于存在冲突的数据,系统会给出警告提示,需操作员干预。
- 数据冲突校验：在实时数据采集中,系统对检测到的冲突数据进行校验,并发出警告提示,确保数据准确性。

#### 数据处理流程：

- 1. 设备数据采集：
   - RS-232 设备：通过 WiFi 适配器将数据发送到局域网。
   - 蓝牙设备：直接与采集终端（如平板电脑）配对，传输数据。
   - 共享文件夹设备：将数据（图片和 XML）保存到指定的网络共享文件夹。

- 2. 数据接收和预处理：
   - 对于 RS-232 和蓝牙设备：局域网内的节点接收数据，进行初步验证和格式化。
   - 对于共享文件夹：系统定期扫描文件夹，检测新文件，读取并解析 XML 数据，处理相关图片。

- 3. 数据解析和存储：
   - 将不同来源的数据统一解析为系统标准格式。
   - 将解析后的数据存储到本地数据库或缓存中。

- 4. 数据同步：
   - 根据网络状况和系统设置，将本地存储的数据同步到中心化后台。
   - 实现断点续传功能，确保在网络不稳定情况下的数据完整性。

- 5. 数据验证和反馈：
   - 中心化后台接收数据后进行二次验证。
   - 向采集端反馈数据接收和处理状态，确保数据的完整性和准确性。

通过这种设计，系统能够适应多种不同类型的设备和数据传输方式，提高了系统的兼容性和灵活性。同时，分布式的设计确保了系统在各种网络环境下的稳定性和可靠性。

#### 数据采集和处理增强：
- 多设备数据采集支持：兼容各种筛查设备，支持多种数据采集方式，确保系统的广泛适用性。
- 离线数据采集和同步：在网络不稳定情况下支持离线数据采集，并在网络恢复后自动同步，保证数据的完整性。
- 数据导入和导出：支持批量数据导入和导出功能，方便数据迁移、备份和与其他系统的数据交换。
- 数据清洗和验证：实现自动化的数据清洗流程，包括格式统一、异常值检测和数据完整性检查，确保数据质量。
- 实时数据处理：利用流处理技术，实现数据的实时分析和反馈，支持快速决策和异常检测。

### 4.2 任务管理与调度模块
- 智能任务分配：根据学校规模、地区等因素，自动分配筛查任务，确保高效执行。
- 进度跟踪：实时查看筛查任务的进展，及时解决任务执行中的问题。
- 任务创建与分配：按学段和地区创建筛查任务，通过系统将任务分配给各筛查小组。筛查小组长可以查看任务进度，分配小组成员并指定筛查设备。
- 自动化通知：任务创建和筛查启动后，系统自动向校方经办人发送短信或微信通知，以便沟通筛查进度和调整筛查时间。
- 简化排期工具：系统提供便于调整和重新排期的工具，确保多校、多任务筛查计划的灵活性。

### 4.3 数据分析与规则维护
- 灵活配置：允许管理员自定义数据分析规则，满足不同层级的需求。
- 自动化分析：通过数据规则自动进行异常检测，生成分析报告。

### 4.4 报表与大屏展示
- 动态报表：支持生成符合各层级需求的筛查报告，用户可自定义报表样式。
- 大屏展示：用于教育局的实时监控，展示筛查进展、数据趋势和异常情况。
- 数据统计与对比分析：系统提供筛查结果的统计分析报告，支持校区、年级和班级维度的数据对比，展示逐年变化的趋势分析。

### 4.5 家长服务模块
- 报告查询：家长可以通过系统查看孩子的视力筛查报告，了解筛查结果。
- 在线咨询：集成在线问答或客服系统，家长可以获取专业的视力健康咨询服务。
- 预约系统：支持家长预约线下眼科检查，便于后续治疗。
- 结果查询：家长在筛查完成后，通过扫描学生信息卡上的二维码，可通过微信小程序查询孩子的筛查结果，系统中同时会记录家长是否查看结果的状态。
- 复查与干预建议：筛查后的复查和干预建议由眼科医务部门审核后开放给学校和家长，家长可以在系统中查看这些建议，并记录后续是否进行了复查和诊疗。

### 4.6 角色管理模块
- 系统定义了多个角色,包括筛查小组组长、视力表操作员等,确保筛查工作中角色分工明确。
- 不同角色拥有相应的权限和功能访问,提高工作效率和数据安全性。

### 4.7 客户端管理模块
- 确保客户端程序能够与各种检测设备连接,并在需要时与云端顺利通信。
- 提供设备连接测试功能,确保筛查开始前所有设备都能正常工作。

### 4.8 漏筛与补筛管理
- 漏筛与补筛管理：系统自动生成漏筛学生的清单，支持校方通知家长前往门诊进行补筛。通过系统的通知功能向目标家长发送微信或短信通知，并支持家长反馈。

### 4.9 系统管理和维护
- 系统监控：包括性能监控和错误检测报告。
- 系统配置：支持系统参数配置和多语言支持配置。

### 4.10 检测项目管理
- 检测项目：新增和编辑检查项及对应的信息内容、指标范围值等
- 检测分类：统一管理检查项目分类字典，检测报告模板字段可根据任务指定检测项目生成
- 干预方案：新增和编辑干预方案，根据指标范围编辑对应的指标方案，设置检测数值范围、数据类型

### 4.11 用户访问统计
- 报告查询统计：查询时间、查询途径
- 咨询客服统计：页面访问次数、咨询对象
- 门店补查统计
- 干预措施统计：配镜、视觉训练、药物

### 4.12 模板配置管理
- 支持自定义拖动配置模板并修改标题及字段信息
- 模板支持针对不同的机构或检测对象进行针对性配置
- 支持模板编辑、模板可增加或减少展示检测项目字段及启用禁用
- 模板支持批量选择适用对象、支持对象独立编辑模板，模板支持继承编辑
- 检测报告关联门店且展示所关联门店
- 系统提供默认模板

### 4.13 移动端功能

#### 4.13.1 用户查询端
- 访问入口：公众号菜单、通知短信内的链接、客服人员分享的链接
- 登录：账号（手机号）+密码+图形验证码，忘记密码功能
- 账户管理：绑定和解绑学生信息
- 通知：订阅通知，接收补查、复查微信消息
- 报告查看：查看检测报告和干预方案，下载PDF报告，查看历史对比数据
- 在线预约：支持定位导航，查看线下机构信息
- 健康知识：查看图文科普知识，报告相关专业术语，检查遵循的相关标准

#### 4.13.2 筛查采集端
- 登录：与用户查询端类似
- 工作台：签到进场、查看项目进度、链接设备、巡检动作
- 现场筛查：有设备和无设备两种模式，支持学生选择、数据采集、异常处理
- 异常管理：提示异常项目或数据，支持异常信息编辑和提交
- 检测任务管理：查看待开始、进行中、已完成的任务，以及检测数据统计
- 个人信息管理：维护个人信息、密码、专业证书，绑定/解绑微信
